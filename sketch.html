<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Adaptive Concretization for Parallel Program Synthesis</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/custom.css">

  <!-- Scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
  <link rel="stylesheet" href="css/github-prettify-theme.css">
  <script src="js/site.js"></script>

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">
</head>
<body class="code-snippets-visible">

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">

    <div class="navbar-spacer"></div>
    <nav class="navbar">
      <div class="container">
        <ul class="navbar-list">
          <li class="navbar-item"><a class="navbar-link" href="index.html#intro">Intro</a></li>
          <li class="navbar-item">
            <a class="navbar-link" href="#" data-popover="#downloadPopover">Downloads</a>
            <div id="downloadPopover" class="popover">
              <ul class="popover-list">
                <li class="popover-item">
                  <a class="popover-link" href="index.html#OVA">OVA</a>
                </li>
                <li class="popover-item">
                  <a class="popover-link" href="index.html#tar-ball">tar ball</a>
                </li>
              </ul>
            </div>
          </li>
          <li class="navbar-item">
            <a class="navbar-link" href="#" data-popover="#sketchPopover">Sketch</a>
            <div id="sketchPopover" class="popover">
              <ul class="popover-list">
                <li class="popover-item">
                  <a class="popover-link" href="#source">source</a>
                </li>
                <li class="popover-item">
                  <a class="popover-link" href="#usage">usage</a>
                </li>
                <li class="popover-item">
                  <a class="popover-link" href="#output">output</a>
                </li>
              </ul>
            </div>
          </li>
          <li class="navbar-item">
            <a class="navbar-link" href="#" data-popover="#expNavPopover">Experiments</a>
            <div id="expNavPopover" class="popover">
              <ul class="popover-list">
                <li class="popover-item">
                  <a class="popover-link" href="exp.html#infra">infra</a>
                </li>
                <li class="popover-item">
                  <a class="popover-link" href="exp.html#DB">database</a>
                </li>
                <li class="popover-item">
                  <a class="popover-link" href="exp.html#exp-short">short</a>
                </li>
                <li class="popover-item">
                  <a class="popover-link" href="exp.html#exp-full">full</a>
                </li>
                <li class="popover-item">
                  <a class="popover-link" href="exp.html#exp-output">output</a>
                </li>
                <li class="popover-item">
                  <a class="popover-link" href="exp.html#exp-raw">raw data</a>
                </li>
              </ul>
            </div>
          </li>
        </ul>
      </div>
    </nav>

    <div class="docs-section" id="source">
      <h5 class="docs-header">Source</h5>
      <p>
In case you are interested, here is a harder way to build Sketch.
To reclaim what we claim in the paper, clone the specific versions of
<a href="https://bitbucket.org/gatoatigrado/sketch-frontend">sketch-frontend</a>
and
<a href="https://bitbucket.org/gatoatigrado/sketch-backend">sketch-backend</a>:
      </p>
<pre><code>.../ae $ hg clone -r e026b22d00ee131b4ecf8ffa3845083626c1e40f \
> https://bitbucket.org/gatoatigrado/sketch-frontend
.../ae $ hg clone -r d9f004c9a54c063ee57a14f09fa5e0d7d81a1291 \
> https://bitbucket.org/gatoatigrado/sketch-backend
</code></pre>
      <p>
Make sure that you have <code>java</code>, <code>javac</code>,
and <code>mvn</code> for sketch-frontend;
<code>gcc</code>, <code>g++</code>, <code>bison</code>, and <code>flex</code>
for sketch-backend.
(You may need to install <code>autoconf</code>, <code>automake</code>,
and <code>libtool</code>, too.)
Then, build Sketch as follows:
      </p>
<pre><code>.../ae $ cd sketch-frontend
.../ae/sketch-frontend $ make assemble-noarch
</code></pre>
<pre><code>.../ae $ cd sketch-backend
.../ae/sketch-backend $ ./autogen.sh
.../ae/sketch-backend $ chmod +x ./configure
.../ae/sketch-backend $ ./configure
.../ae/sketch-backend $ make clean; make
</code></pre>
      <p>
You can run a simple test case to make sure the build is correct:
      </p>
<pre><code>.../ae $ cd sketch-frontend
.../ae/sketch-frontend $ make run-local-seq EXEC_ARGS="src/test/sk/seq/miniTest1.sk"
</code></pre>
      <p>
One possible issue you may encounter while building sketch-frontend is
the inconsistent Java version in Maven, e.g., Maven refers to Java 1.6
while the main Java you're using is 1.7 or higher.  In that case, set up
<code>$JAVA_HOME</code> properly:
<a href="http://stackoverflow.com/questions/18813828/why-maven-use-jdk-1-6-but-my-java-version-is-1-7">stackoverflow</a>.
      </p>
      <p>
If you suffer from any other build errors, please contact the authors.
      </p>
    </div>

    <div class="docs-section" id="usage">
      <h5 class="docs-header">Usage</h5>
      <p>
To use <code>sketch</code> from anywhere,
we recommend you to set up your environment accordingly.
      </p>
      <p>
For the tar ball users:
      </p>
<pre><code>export SKETCH_HOME=/path/to/sketch-1.6.8/sketch-frontend/runtime
export PATH=$PATH:$SKETCH_HOME/..
</code></pre>
      <p>
For the source users:
      </p>
<pre><code>export SKETCH_HOME=/path/to/sketch-frontend
export PATH=$PATH:$SKETCH_HOME/target/sketch-1.6.8-noarch-launchers
</code></pre>
      <p>
If you are using the up-to-date Sketch, double-check Sketch version number,
which may be higher, e.g., <code>1.6.9</code>.
You can see the version number while building sketch-frontend.
      </p>
      <p>
Our testing infrastructure takes care of all the Sketch options
that will be explained below.  Therefore, if you are not interested,
you can move to the <a href="exp.html">Experiments</a> page now.
      </p>
      <p>
The option to enable (random) concretization is:
<code>--slv-randassign</code>.
You can also specify the degree of concretization via
<code>--slv-randdegree n</code>.
(Please refer to the paper for the notions of concretization and its degree.)
      </p>
<pre><code>$ sketch --slv-randassign [--slv-randdegree n] ... target.sk
</code></pre>
      <p>
Since concretized values for holes are random,
the UNSAT result from the back-end doesn't mean the given sketch is indeed UNSAT.
That is, if you are sure that the target sketch is satisfiable,
you need to run concretized sub-problems many times until resolved.
The option <code>--slv-parallel</code> will run many instances of sketch-backend
in parallel.  Note that that option merely runs <em>same</em> instances of
sketch-backend in parallel if you don't pass any options about concretization.
Thus, the preferred usage is:
      </p>
<pre><code>$ sketch --slv-parallel --slv-randassign [--slv-randdegree n] ... target.sk
</code></pre>
      <p>
Rather than a fixed degree of concretization,
the option <code>--slv-strategy WILCOXON</code> will adjust the degree adaptively
until it figures out a statistically better degree than another.
      </p>
<pre><code>$ sketch --slv-parallel --slv-randassign --slv-strategy WILCOXON ... target.sk
</code></pre>
      <p>
There are couple more minor options to tune Sketch behavior:
        <ul>
          <li><code>--slv-p-cpus n</code>: number of cores to use
            <ul>
              <li>Default: 3 quarters of available cores (to not exhaust the system)</li>
              <li>This number is used for set up the size of Java <code>Thread</code> pool. 
                So, if it's set something bigger than what the system has,
                Sketch will still use what the system has.
              </li>
            </ul>
          </li>
          <li><code>--slv-p-timeout t</code>: (adaptive) timeout for parallel trials
            <ul>
              <li>Default: 1 minute</li>
              <li>This will be (adaptively) doubled if timeout happens.</li>
            </ul>
          </li>
          <li><code>--slv-p-trials n</code>: number of parallel trials
            <ul>
              <li>Default: |cores| * 32 * 3</li>
            </ul>
          </li>
          <li><code>--slv-timeout t</code>: timeout for overall Sketch (in minute)
            <ul>
              <li>This option precedes <code>--slv-p-trials</code>.</li>
              <li>That is, if the overall timeout is set, the number of parallel trials
                will be set much bigger (e.g., |cores| * 32 * 32),
                so as to run until that timeout limit.
                (As always, Sketch will stop if one of parallel trials has found a solution.)
              </li>
            </ul>
          </li>
        </ul>
      </p>
    </div>

    <div class="docs-section" id="output">
      <h5 class="docs-header">Output</h5>
      <p>
First of all, don't be alarmed if you saw a bunch of <code>Rejected</code>
and/or <code>UNSATISFIABLE</code> messages.  Those messages are definitely
normal (as long as you run Sketch with this adaptive concretization feature).
With (random) concretization, we can make a sub-synthesis problem smaller,
but its chance of getting lucky (i.e., being correct) is getting lower,
resulting in those many 'Rejected' cases;
we just repeat it until the concretization is (partially) correct.
The key idea is that solving both unlucky (due to the wrong concretization)
and lucky sub-synthesis problems is really quick, and thus repeating such process
again and again is way faster than solving an original synthesis problem
in a purely symbolic manner.
      </p>
      <p>
Therefore, the output of Sketch will be comprised of a sequence of failed trials,
followed by one single successful trial.
Each trial begins and ends with a noticeable separator:
<code>=== parallel trial ... (n) ... ===</code>.
Between those trials, messages attached with <code>[wilcoxon]</code> will
show the detailed steps during the adaption phase, such as
1) starting sampling, 2) calculating distributions, 3) Wilcoxon test, and
4) comparing degrees.  In general, the outputs generated by
Sketch with the adaptive concretization would look like as follows:
      </p>
<pre><code>SKETCH version 1.6.9
Benchmark = benchmark_name
...
... [wilcoxon] start sampling: degree 16
...
... [wilcoxon] start sampling: degree 32
...
... === parallel trial ... (i) started ===
...
... === parallel trial ... (i) failed ===
...
... === parallel trial ... (j) started ===
...
... === parallel trial ... (j) failed ===
...
... [wilcoxon] degree 16 dist: [ ... ]
... [wilcoxon] degree 32 dist: [ ... ]
... [wilcoxon] test (16, 32): 0.xyz
...
... [wilcoxon] compareDegree(16, 32) = (-1 | 0 | 1)
...
... [wilcoxon] degree choice: d
...
... === parallel trial w/ degree d (n-1) started ===
...
... === parallel trial w/ degree d (n-1) failed ===
...
... === parallel trial w/ degree d (n) started ===
...
... === parallel trial w/ degree d (n) solved ===
...
SYNTHESIZED_CODE_OCCURS_HERE
</code></pre>
      <p>
Note that the above example is based on up-to-date Sketch,
so earlier versions may not have same messages.
      </p>
    </div>

  </div>
</body>
</html>
